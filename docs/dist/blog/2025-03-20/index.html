<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    
    <title>How to Host a SSH App Using Nginx | Sairash's Lair</title>
    <meta name="description" content="Learn how to host SSH applications like pomossh">
    <meta name="generator" content="VitePress v1.5.0">
    <link rel="preload stylesheet" href="/assets/style.BIgqUkQP.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.BjTZ1k9O.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.CEa-pAbc.js">
    <link rel="modulepreload" href="/assets/chunks/framework.BDxlaA_J.js">
    <link rel="modulepreload" href="/assets/blog_2025-03-20_index.md.CbdUGL2f.lean.js">
    <link rel="shortcut icon" href="/mascot/bulb.png">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#000">
    <meta name="author" content="Sairash Gautam">
    <meta name="robots" content="index, follow">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Sairash Gautam">
    <meta property="og:url" content="https://sairashgautam.com.np">
    <meta property="og:site_name" content="Sairash's Lair">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Sairash Gautam">
    <meta name="twitter:site" content="@GautamSairash">
    <meta name="twitter:creator" content="@GautamSairash">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="canonical" href="https://sairashgautam.com.np">
    <meta name="msapplication-TileColor" content="#000">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <link rel="preload" as="image" href="https://akocdw82ai.ufs.sh/f/Jk6mQ2VBlE6t07ToMRQDdIqhJteX6svxHmo2KjY3MVwz9bCa">
    <meta name="keywords" content="Learn how to host SSH applications like pomossh">
    <meta property="og:description" content="Learn how to host SSH applications like pomossh">
    <meta property="og:image" content="https://akocdw82ai.ufs.sh/f/Jk6mQ2VBlE6t07ToMRQDdIqhJteX6svxHmo2KjY3MVwz9bCa">
    <meta name="twitter:description" content="Learn how to host SSH applications like pomossh">
    <meta name="twitter:image" content="https://akocdw82ai.ufs.sh/f/Jk6mQ2VBlE6t07ToMRQDdIqhJteX6svxHmo2KjY3MVwz9bCa">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/mascot/wink.png" alt data-v-8426fc1a><!--]--><span data-v-1168a8e4>Sairash&#39;s Lair</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/2024-09-28/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>About Me</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Blog</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/projects" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Projects</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/photos/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Photos</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/sairash" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://sairash.github.io/playable" aria-label target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><svg xmlns="http://www.w3.org/2000/svg" width="0.75em" height="1em" viewBox="0 0 384 512"><path fill="currentColor" d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80v352c0 17.4 9.4 33.4 24.5 41.9S58.2 482 73 473l288-176c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41z"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/sairash" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://sairash.github.io/playable" aria-label target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><svg xmlns="http://www.w3.org/2000/svg" width="0.75em" height="1em" viewBox="0 0 384 512"><path fill="currentColor" d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80v352c0 17.4 9.4 33.4 24.5 41.9S58.2 482 73 473l288-176c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41z"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _blog_2025-03-20_" data-v-39a288b8><div><h1 id="how-to-host-a-ssh-app-using-nginx" tabindex="-1">How to Host a SSH App Using Nginx <a class="header-anchor" href="#how-to-host-a-ssh-app-using-nginx" aria-label="Permalink to &quot;How to Host a SSH App Using Nginx&quot;">​</a></h1><p><a href="/blog">&lt;- Back to blogs</a></p><p><img src="https://akocdw82ai.ufs.sh/f/Jk6mQ2VBlE6t07ToMRQDdIqhJteX6svxHmo2KjY3MVwz9bCa" alt="Host SSH App"><em>Learn how to deploy a Charmbracelet Wish TUI (Terminal User Interface) SSH app on a VPS, proxy it through Nginx and Cloudflare, fix color issues, and ensure reliability.</em></p><p>I wrote an SSH terminal application using <a href="https://github.com/charmbracelet/wish/" target="_blank" rel="noreferrer">wish</a> and <a href="https://github.com/charmbracelet/bubbletea" target="_blank" rel="noreferrer">bubbletea</a>. Everything was going smoothly until it was time to host it. I wasn&#39;t sure how to proceed since I had never hosted an SSH application before, and I was surprised by the lack of articles on this topic. This blog provides an overview of what I needed to do and how I successfully hosted <a href="https://pomo.sairashgautam.com.np" target="_blank" rel="noreferrer">POMO SSH</a>.</p><h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to &quot;Introduction&quot;">​</a></h2><p>Terminal-based applications built with frameworks like <a href="https://charm.sh/" target="_blank" rel="noreferrer">Charmbracelet</a> (Bubble Tea<a href="https://charm.sh/" target="_blank" rel="noreferrer">,</a> Lip Gloss) offer rich interactive experiences. But deploying them over SSH on a VPS while preserving colors and handling TTY allocation can be tricky. In this guide, we’ll:</p><ol><li><p>Proxy a Wish-based SSH server through <strong>Nginx</strong>.</p></li><li><p>Run the app as a <strong>systemd service</strong>.</p></li><li><p>Fix <strong>color/TTY issues</strong> in headless environments.</p></li><li><p>Secure the setup with <strong>Cloudflare DNS</strong>.</p></li></ol><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><ul><li><p>A VPS (Any Operating System).</p></li><li><p>Domain name (<a href="http://pomo.sairashgautam.com.np" target="_blank" rel="noreferrer">pomo.sairashgautam.com.np</a>).</p></li><li><p>A Wish/BubbleTea SSH app.</p></li></ul><h2 id="configure-cloudflare" tabindex="-1">Configure Cloudflare: <a class="header-anchor" href="#configure-cloudflare" aria-label="Permalink to &quot;Configure Cloudflare:&quot;">​</a></h2><p>If you are using Cloudflare as your reverse proxy provider, then only the following step is needed. Otherwise, you can skip to the next topic.</p><p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1742664371134/25965c39-6bd7-40b6-a342-09a01a254b72.png" alt="Cloudflare Screenshot"></p><p>As shown in the image above, you need to switch the proxy status to &quot;DNS only&quot; because Cloudflare’s free plan does not proxy TCP traffic, such as SSH.</p><h2 id="nginx-tcp-proxy-setup" tabindex="-1">Nginx TCP Proxy Setup <a class="header-anchor" href="#nginx-tcp-proxy-setup" aria-label="Permalink to &quot;Nginx TCP Proxy Setup&quot;">​</a></h2><p>Since SSH is a TCP protocol, we’ll use Nginx’s <code>stream</code> module which is used to handle TCP and UDP traffic, providing functionalities such as load balancing, proxying, and SSL/TLS termination for non-HTTP protocols.</p><h4 id="step-1-configure-nginx" tabindex="-1"><strong>Step 1: Configure Nginx</strong> <a class="header-anchor" href="#step-1-configure-nginx" aria-label="Permalink to &quot;**Step 1: Configure Nginx**&quot;">​</a></h4><p>Edit <code>/etc/nginx/nginx.conf</code> and add:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FF9492;">stream</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#FF9492;">    server</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#FF9492;">        listen </span><span style="color:#91CBFF;">22</span><span style="color:#F0F3F6;">;                   </span><span style="color:#BDC4CC;"># Listen on default SSH port</span></span>
<span class="line"><span style="color:#FF9492;">        proxy_pass </span><span style="color:#F0F3F6;">127.0.0.1:13234;  </span><span style="color:#BDC4CC;"># Forward to Wish app</span></span>
<span class="line"><span style="color:#FF9492;">        proxy_responses </span><span style="color:#91CBFF;">0</span><span style="color:#F0F3F6;">;           </span><span style="color:#BDC4CC;"># Required for SSH</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span>
<span class="line"></span></code></pre></div><p>Now, here&#39;s the part where you need to set the port and be extra careful. You are trying to override the default SSH port used to log in to your VPS. You might wonder why this is necessary. If you want your users to access your application without specifying the port, you need to do this.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FFB757;">ssh</span><span style="color:#ADDCFF;"> pomo.sairashgautam.com.np</span><span style="color:#BDC4CC;"> # no need to provide port as the default is 22</span></span>
<span class="line"></span></code></pre></div><p>If you skip this step, your users will have to specify the port.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FFB757;">ssh</span><span style="color:#ADDCFF;"> pomo.sairashgautam.com.np</span><span style="color:#91CBFF;"> -p</span><span style="color:#91CBFF;"> 2222</span><span style="color:#BDC4CC;"> # provide port manually</span></span>
<span class="line"></span></code></pre></div><h4 id="step-2-free-up-port-22-if-needed" tabindex="-1"><strong>Step 2: Free Up Port 22 (If Needed)</strong> <a class="header-anchor" href="#step-2-free-up-port-22-if-needed" aria-label="Permalink to &quot;**Step 2: Free Up Port 22 (If Needed)**&quot;">​</a></h4><p>If your VPS’s default SSH server uses port <code>22</code>, reconfigure it:</p><ol><li><p>Edit <code>/etc/ssh/sshd_config</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FFB757;">Port</span><span style="color:#91CBFF;"> 2222</span><span style="color:#BDC4CC;">  # Change to a new port</span></span>
<span class="line"></span></code></pre></div></li><li><p>Restart SSH and update firewall:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FFB757;">sudo</span><span style="color:#ADDCFF;"> systemctl</span><span style="color:#ADDCFF;"> restart</span><span style="color:#ADDCFF;"> ssh</span></span>
<span class="line"><span style="color:#FFB757;">sudo</span><span style="color:#ADDCFF;"> ufw</span><span style="color:#ADDCFF;"> allow</span><span style="color:#ADDCFF;"> 2222/tcp</span></span>
<span class="line"></span></code></pre></div></li></ol><h4 id="step-3-allow-port-22-for-nginx" tabindex="-1"><strong>Step 3: Allow Port 22 for Nginx</strong> <a class="header-anchor" href="#step-3-allow-port-22-for-nginx" aria-label="Permalink to &quot;**Step 3: Allow Port 22 for Nginx**&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FFB757;">sudo</span><span style="color:#ADDCFF;"> ufw</span><span style="color:#ADDCFF;"> allow</span><span style="color:#ADDCFF;"> 22/tcp</span></span>
<span class="line"><span style="color:#FFB757;">sudo</span><span style="color:#ADDCFF;"> nginx</span><span style="color:#91CBFF;"> -t</span></span>
<span class="line"><span style="color:#FFB757;">sudo</span><span style="color:#ADDCFF;"> systemctl</span><span style="color:#ADDCFF;"> reload</span><span style="color:#ADDCFF;"> nginx</span></span>
<span class="line"></span></code></pre></div><h4 id="step-4-test-ssh-connection" tabindex="-1"><strong>Step 4: Test SSH Connection</strong> <a class="header-anchor" href="#step-4-test-ssh-connection" aria-label="Permalink to &quot;**Step 4: Test SSH Connection**&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FFB757;">ssh</span><span style="color:#ADDCFF;"> pomo.sairashgautam.com.np</span><span style="color:#BDC4CC;">  # Should connect to your ssh application</span></span>
<span class="line"></span></code></pre></div><p>Note: To connect to your Wish application or any other SSH application, make sure it is running.</p><hr><h2 id="run-as-a-systemd-service" tabindex="-1">Run as a Systemd Service <a class="header-anchor" href="#run-as-a-systemd-service" aria-label="Permalink to &quot;Run as a Systemd Service&quot;">​</a></h2><p>To run your app in the background and make sure it continues running even after reboots and crashes, let&#39;s create a <strong>systemd</strong> service.</p><h4 id="step-1-create-service-file" tabindex="-1"><strong>Step 1: Create Service File</strong> <a class="header-anchor" href="#step-1-create-service-file" aria-label="Permalink to &quot;**Step 1: Create Service File**&quot;">​</a></h4><p>Save to <code>/etc/systemd/system/myapp.service</code>:</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FFB757;">[Unit]</span></span>
<span class="line"><span style="color:#FF9492;">Description</span><span style="color:#F0F3F6;">=Myapp (SSH App)</span></span>
<span class="line"><span style="color:#FF9492;">After</span><span style="color:#F0F3F6;">=network.target</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFB757;">[Service]</span></span>
<span class="line"><span style="color:#FF9492;">Type</span><span style="color:#F0F3F6;">=simple</span></span>
<span class="line"><span style="color:#FF9492;">User</span><span style="color:#F0F3F6;">=userapp</span></span>
<span class="line"><span style="color:#FF9492;">Group</span><span style="color:#F0F3F6;">=myapp</span></span>
<span class="line"><span style="color:#FF9492;">WorkingDirectory</span><span style="color:#F0F3F6;">=/path/to/workdir  </span><span style="color:#BDC4CC;"># Replace to your path</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">Environment</span><span style="color:#F0F3F6;">=</span><span style="color:#FF9492;">TERM</span><span style="color:#F0F3F6;">=xterm-256color    </span><span style="color:#BDC4CC;"># Force 256-color mode</span></span>
<span class="line"><span style="color:#FF9492;">Environment</span><span style="color:#F0F3F6;">=</span><span style="color:#FF9492;">COLORTERM</span><span style="color:#F0F3F6;">=truecolor    </span><span style="color:#BDC4CC;"># Enable truecolor</span></span>
<span class="line"><span style="color:#FF9492;">StandardInput</span><span style="color:#F0F3F6;">=tty                  </span><span style="color:#BDC4CC;"># Allocate TTY</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;"># Critical PTY allocation settings</span></span>
<span class="line"><span style="color:#FF9492;">TTYPath</span><span style="color:#F0F3F6;">=/dev/tty0</span></span>
<span class="line"><span style="color:#FF9492;">TTYReset</span><span style="color:#F0F3F6;">=yes</span></span>
<span class="line"><span style="color:#FF9492;">TTYVHangup</span><span style="color:#F0F3F6;">=yes</span></span>
<span class="line"><span style="color:#FF9492;">TTYVTDisallocate</span><span style="color:#F0F3F6;">=yes               </span><span style="color:#BDC4CC;"># Cleanup TTY on exit</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;"># Force PTY allocation with explicit PAM session</span></span>
<span class="line"><span style="color:#FF9492;">PAMName</span><span style="color:#F0F3F6;">=login</span></span>
<span class="line"><span style="color:#FF9492;">UtmpIdentifier</span><span style="color:#F0F3F6;">=myapp</span></span>
<span class="line"><span style="color:#FF9492;">UtmpMode</span><span style="color:#F0F3F6;">=user</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;"># Use &#39;script&#39; to force PTY allocation</span></span>
<span class="line"><span style="color:#FF9492;">ExecStart</span><span style="color:#F0F3F6;">=/usr/bin/script -q -c </span><span style="color:#ADDCFF;">&quot;/path/to/binary&quot;</span><span style="color:#F0F3F6;"> /dev/null </span><span style="color:#BDC4CC;"># Replace to your go bin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">Restart</span><span style="color:#F0F3F6;">=on-failure         </span><span style="color:#BDC4CC;"># Auto-restart on crashes</span></span>
<span class="line"><span style="color:#FF9492;">RestartSec</span><span style="color:#F0F3F6;">=5               </span><span style="color:#BDC4CC;"># Wait 5 seconds before retrying</span></span>
<span class="line"><span style="color:#FF9492;">StartLimitIntervalSec</span><span style="color:#F0F3F6;">=0    </span><span style="color:#BDC4CC;"># Disable restart limits</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFB757;">[Install]</span></span>
<span class="line"><span style="color:#FF9492;">WantedBy</span><span style="color:#F0F3F6;">=multi-user.target  </span><span style="color:#BDC4CC;"># Start on system boot</span></span>
<span class="line"></span></code></pre></div><p>If you&#39;ve seen the service example shared in the Wish documentation: <a href="https://github.com/charmbracelet/wish/?tab=readme-ov-file#running-with-systemd" target="_blank" rel="noreferrer">Link</a>, it might look a bit different. That&#39;s because when I tried it, it didn&#39;t work as expected. It worked, but the colors from Lip Gloss didn&#39;t display correctly. So, I wrote this version to enable color. There might be better solutions, and if I find one, I&#39;ll update this section. (If you know any, please share them with me.)</p><h4 id="explanation" tabindex="-1"><strong>Explanation:</strong> <a class="header-anchor" href="#explanation" aria-label="Permalink to &quot;**Explanation:**&quot;">​</a></h4><p>Headless environments often lack proper terminal emulation, causing BubbleTea/LipGloss colors to vanish.</p><h4 id="why-it-happens" tabindex="-1"><strong>Why It Happens</strong> <a class="header-anchor" href="#why-it-happens" aria-label="Permalink to &quot;**Why It Happens**&quot;">​</a></h4><ul><li><p>Systemd doesn’t allocate a <strong>pseudo-terminal (PTY)</strong> by default.</p></li><li><p>Missing <code>TERM</code>/<code>COLORTERM</code> environment variables.</p></li></ul><h4 id="the-fix" tabindex="-1"><strong>The Fix</strong> <a class="header-anchor" href="#the-fix" aria-label="Permalink to &quot;**The Fix**&quot;">​</a></h4><ol><li><p><strong>Force PTY Allocation</strong>:</p><ul><li>Use <code>script -q -c &quot;command&quot;</code> or <code>socat</code> in <code>ExecStart</code>.</li></ul></li><li><p><strong>Set Terminal Environment</strong>:</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FF9492;">Environment</span><span style="color:#F0F3F6;">=</span><span style="color:#FF9492;">TERM</span><span style="color:#F0F3F6;">=xterm-256color</span></span>
<span class="line"><span style="color:#FF9492;">Environment</span><span style="color:#F0F3F6;">=</span><span style="color:#FF9492;">COLORTERM</span><span style="color:#F0F3F6;">=truecolor</span></span>
<span class="line"></span></code></pre></div></li><li><p><strong>Add TTY Configuration</strong>:</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FF9492;">StandardInput</span><span style="color:#F0F3F6;">=tty</span></span>
<span class="line"><span style="color:#FF9492;">TTYPath</span><span style="color:#F0F3F6;">=/dev/tty0</span></span>
<span class="line"><span style="color:#FF9492;">TTYReset</span><span style="color:#F0F3F6;">=yes</span></span>
<span class="line"></span></code></pre></div></li></ol><h4 id="step-2-fix-tty-permissions" tabindex="-1"><strong>Step 2: Fix TTY Permissions</strong> <a class="header-anchor" href="#step-2-fix-tty-permissions" aria-label="Permalink to &quot;**Step 2: Fix TTY Permissions**&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FFB757;">sudo</span><span style="color:#ADDCFF;"> usermod</span><span style="color:#91CBFF;"> -aG</span><span style="color:#ADDCFF;"> tty</span><span style="color:#ADDCFF;"> userapp</span><span style="color:#BDC4CC;">  # Grant user access to TTY devices</span></span>
<span class="line"></span></code></pre></div><h4 id="step-3-enable-start-service" tabindex="-1"><strong>Step 3: Enable &amp; Start Service</strong> <a class="header-anchor" href="#step-3-enable-start-service" aria-label="Permalink to &quot;**Step 3: Enable &amp; Start Service**&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FFB757;">sudo</span><span style="color:#ADDCFF;"> systemctl</span><span style="color:#ADDCFF;"> daemon-reload</span></span>
<span class="line"><span style="color:#FFB757;">sudo</span><span style="color:#ADDCFF;"> systemctl</span><span style="color:#ADDCFF;"> enable</span><span style="color:#ADDCFF;"> pomossh.service</span><span style="color:#BDC4CC;">  # Start on boot</span></span>
<span class="line"><span style="color:#FFB757;">sudo</span><span style="color:#ADDCFF;"> systemctl</span><span style="color:#ADDCFF;"> start</span><span style="color:#ADDCFF;"> pomossh.service</span></span>
<span class="line"></span></code></pre></div><h4 id="step-4-verify" tabindex="-1"><strong>Step 4: Verify</strong> <a class="header-anchor" href="#step-4-verify" aria-label="Permalink to &quot;**Step 4: Verify**&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FFB757;">systemctl</span><span style="color:#ADDCFF;"> status</span><span style="color:#ADDCFF;"> pomossh.service</span><span style="color:#BDC4CC;">  # Check service health</span></span>
<span class="line"><span style="color:#FFB757;">journalctl</span><span style="color:#91CBFF;"> -u</span><span style="color:#ADDCFF;"> pomossh.service</span><span style="color:#91CBFF;"> -f</span><span style="color:#BDC4CC;">  # Tail logs</span></span>
<span class="line"></span></code></pre></div><hr><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><ul><li><p><strong>No Colors?</strong></p><ul><li><p>Verify <code>TERM</code> and <code>COLORTERM</code> are set.</p></li><li><p>Test manually: <code>script -q -c &quot;./binary&quot;</code>.</p></li></ul></li><li><p><strong>TTY Allocation Failed?</strong></p><ul><li><p>Check user’s TTY group: <code>groups userapp</code>.</p></li><li><p>Run <code>strace -f -e trace=openat ./binary</code> to debug device access.</p></li></ul></li></ul><hr><h2 id="final-command" tabindex="-1">Final Command <a class="header-anchor" href="#final-command" aria-label="Permalink to &quot;Final Command&quot;">​</a></h2><p>Connect to your TUI app:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark-high-contrast" style="background-color:#0a0c10;color:#f0f3f6;" tabindex="0"><code><span class="line"><span style="color:#FFB757;">ssh</span><span style="color:#ADDCFF;"> tui.example.com</span><span style="color:#BDC4CC;">  # Enjoy your BubbleTea app in full color!</span></span>
<span class="line"></span></code></pre></div><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">​</a></h2><p>By combining Nginx’s TCP proxying, systemd’s service management, and terminal emulation tricks, you can deploy SSH (Charmbracelet/BubbleTea) apps reliably. This setup works not just for SSH apps, but any TUI tool needing PTY allocation (e.g., SSH-based games, admin dashboards).</p><p>For advanced use cases, explore:</p><ul><li><p><a href="https://developers.cloudflare.com/cloudflare-one/" target="_blank" rel="noreferrer">Cloudflare Zero Trust</a> (paid SSH proxying).</p></li><li><p><code>tmux</code> or <code>screen</code> for session persistence.</p></li></ul><p>Hashnode: <a href="https://sairash.hashnode.dev/" target="_blank" rel="noreferrer">Sairash Blogs</a></p><p><span style="color:gray;font-size:14px;">Date: 2025-03-20</span><img src="/mascot/thumbsup.png" style="height:170px;position:absolute;right:0;"></p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"blog.md\":\"l_AYBs_9\",\"blog_2024-09-28_index.md\":\"BC71OlOj\",\"blog_2024-10-02_index.md\":\"nbHJx8Sc\",\"blog_2024-10-09_index.md\":\"B2-Irp7z\",\"blog_2024-10-11_index.md\":\"FCTPkSdY\",\"blog_2024-10-12_index.md\":\"B6tssC32\",\"blog_2024-10-14_index.md\":\"D6zJz8IO\",\"blog_2024-10-19_index.md\":\"CcaIFzh-\",\"blog_2024-10-29_index.md\":\"DiEzB-5x\",\"blog_2024-11-07_index.md\":\"Bl2KuvM2\",\"blog_2024-11-10_index.md\":\"CSGvTV9L\",\"blog_2024-11-15_index.md\":\"CgJkbt3f\",\"blog_2024-11-17_index.md\":\"BNo-9plz\",\"blog_2024-11-20_index.md\":\"DHRBvbhW\",\"blog_2024-11-27_index.md\":\"0CgOK2En\",\"blog_2024-12-02_index.md\":\"e0qeEczj\",\"blog_2024-12-24_index.md\":\"aQIx0A_8\",\"blog_2025-01-21_index.md\":\"UVptwQ9i\",\"blog_2025-02-15_index.md\":\"DYywlTTX\",\"blog_2025-03-20_index.md\":\"CbdUGL2f\",\"blog_2025-03-31_index.md\":\"BZon7F06\",\"definations_mascot.md\":\"B0RSxsXc\",\"definations_namaste.md\":\"DEyEuBO6\",\"index.md\":\"UcHW0Zjf\",\"photos_2025_index.md\":\"Df1gJPGD\",\"photos_index.md\":\"BN47Fftv\",\"projects.md\":\"DeajSIRe\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Sairash's Lair\",\"description\":\"The Tale of Sairash.\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/mascot/wink.png\",\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"About Me\",\"link\":\"/blog/2024-09-28/\"},{\"text\":\"Blog\",\"link\":\"/blog\"},{\"text\":\"Projects\",\"link\":\"/projects\"},{\"text\":\"Photos\",\"link\":\"/photos/\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/sairash\"},{\"icon\":{\"svg\":\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"0.75em\\\" height=\\\"1em\\\" viewBox=\\\"0 0 384 512\\\"><path fill=\\\"currentColor\\\" d=\\\"M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80v352c0 17.4 9.4 33.4 24.5 41.9S58.2 482 73 473l288-176c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41z\\\"/></svg>\"},\"link\":\"https://sairash.github.io/playable\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>